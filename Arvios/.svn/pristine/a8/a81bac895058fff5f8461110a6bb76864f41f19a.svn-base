
/*  Map : Asynchronously Loading the API->Speed up
--------------------------------------------------------------------------------*/

function initialize() { 
  var isDraggable = jQuery(document).width() > 480 ? true : false; // If 
  var mapOptions = {
    zoom: 8,
    center: new google.maps.LatLng(WILOKE_GOOGLEMAP.lat,WILOKE_GOOGLEMAP.long),
    draggable: isDraggable,
    scrollwheel: false, // Prevent users to start zooming the map when scrolling down the page
  }; 
 
  var map = new google.maps.Map(document.getElementById('map'),
      mapOptions);
}


function loadScript() {
  var mapID = document.getElementById('map'); 
  if ( mapID != null )
  {

    var script = document.createElement('script');
    script.type = 'text/javascript';
    script.src = 'https://maps.googleapis.com/maps/api/js?v=3.exp&' +
        'callback=initialize';
    document.body.appendChild(script);
  }
}
window.onload = loadScript;


(function($) {
    "use strict";

    var isMobile = {
        Android: function() {
            return navigator.userAgent.match(/Android/i);
        },
        BlackBerry: function() {
            return navigator.userAgent.match(/BlackBerry/i);
        },
        iOS: function() {
            return navigator.userAgent.match(/iPhone|iPad|iPod/i);
        },
        Opera: function() {
            return navigator.userAgent.match(/Opera Mini/i);
        },
        Windows: function() {
            return navigator.userAgent.match(/IEMobile/i);
        },
        any: function() {
            return (isMobile.Android() || isMobile.BlackBerry() || isMobile.iOS() || isMobile.Opera() || isMobile.Windows());
        }
    }

    function main() {
        var windowHeight = 0,
            adminbarHeight = 0;

        if ( $(".error404").length>0 )
        {
            $(".error404").height( windowHeight );
            $(".page-not-found-bg").height( windowHeight -   $("#footer").outerHeight() );
        }

        $(window).on('load resize', function() 
        {

            windowHeight = $(window).height();
            if ( $("#wpadminbar").length>0 )
            {
                adminbarHeight = $("#wpadminbar").height();
                $(".pi-navigation .nav.nav-mobile").css({top: adminbarHeight});
            }

            if ( $(".pi-navigation.nav-bottom").length>0 )
            {
                windowHeight = windowHeight - adminbarHeight; 
            }
            $('.home-media, .text-slider .item').height(windowHeight);
        });

        $('.home-slider').superslides({
            animation: 'fade',
            play: 4000,
            pagination: false
        });

        $('.toggle-search').on('click', function() {
            $('.search-box').toggleClass('active');
        });
        $('html').on('click', function() {
            $('.search-box').removeClass('active');
        });
        $('.search-box').on('click', function(evt) {
            evt.stopPropagation();
        });

        if ( $("body.page-template-homepage").length < 1 )
        {
            console.log("dad");
            if ( $(".pi-navigation").length > 0 )
            {
                var _getLink  = "";
                $("#pi-main-menu li a").each(function()
                {
                    _getLink = $(this).attr("href");
                    
                    if ( hasThang( _getLink ) )
                    {
                        $(this).attr("href", woHomeUrl + '/' +_getLink);
                    }
                })
            }
        }

        if ( $(".pi-navigation").length>0 )
        {
            $('.pi-navigation .nav')
                .children()
                .children('a:first')
                    .append('<i class="fa fa-home"></i>'); 

            $(window).on('scroll', function() {
                var scrollTop = $(window).scrollTop(),
                    navOffset = $('.pi-navigation').offset().top,
                    navHeight = $('.pi-navigation').height(),
                    windowHeight = $(window).height();
                if (scrollTop >= navOffset) {
                    $('.pi-navigation').addClass('nav-fixed');
                }
                if (scrollTop < (windowHeight - navHeight)) {
                   $('.pi-navigation').removeClass('nav-fixed'); 
                }
            });

            $('.page-template-homepage .pi-navigation').find('.nav > li').on('click', '> a', function(evt) {
               
                var $anchor = $(this);
                if ( hasThang($anchor.attr("href") ) )
                {
                    evt.preventDefault();
                    $('html, body').stop().animate({
                        scrollTop: $($anchor.attr('href')).offset().top
                    }, 800, 'easeInOutExpo');
                    setTimeout(function() {
                        $('.nav-mobile').removeClass('nav-active');
                    }, 800);
                }
            });

            $('.pi-navigation .sub-menu').each(function() {
                var offsetLeft = $(this).offset().left,
                    width = $(this).width(),
                    offsetRight = ($(window).width() - (offsetLeft + width));
              
                if (offsetRight < 100) {
                    $(this)
                    .removeClass('left')
                    .addClass('right');
                } else {
                    $(this)
                    .removeClass('right');
                }
                if (offsetLeft < 100) {
                    $(this)
                        .removeClass('right')
                        .addClass('left');
                } else {
                    $(this)
                        .removeClass('left');
                }
            });
            $(window).on('resize load', function() {
                var menuType = $('.pi-navigation').data('menu-type'),
                    windowWidth = window.innerWidth;
                if (windowWidth <= menuType) {
                    $('.open-menu')
                        .show();
                    $('.search-box')
                        .addClass('search-mobile');
                    $('.pi-navigation')
                        .find('.nav')
                            .removeClass('nav-hover')
                            .addClass('nav-mobile');

                    if ($('.close-menu').length == 0) {
                        $('.pi-navigation')
                            .find('.nav')
                                .after('<a href="#" class="close-menu">\
                                            <span></span>\
                                        </a>'
                                );
                    }
                } else {
                    $('.open-menu')
                        .hide();
                    $('.search-box')
                        .removeClass('search-mobile');
                    $('.pi-navigation')
                        .find('.nav')
                        .addClass('nav-hover')
                        .removeClass('nav-mobile');
                }
            });
            $('.menu-item-has-children')
                .children('a')
                .after(
                    '<span class="submenu-toggle"></span>'
                );
            $('.submenu-toggle').on('click', function() {
                $(this).siblings('.sub-menu').addClass('translate');
            });
            $('.sub-menu').each(function() {
                $(this)
                    .prepend(
                        '<li class="back-mb">\
                            <a href="#">\
                            </a>\
                        </li>'
                    );
                $('.back-mb').on('click', 'a', function(evt) {
                    evt.preventDefault();
                    $(this)
                      .parent()
                      .parent()
                      .removeClass('translate');
                });
            });

            $('.open-menu').on('click', function(evt) {
                evt.preventDefault();
                evt.stopPropagation();
                $('.nav-mobile').addClass('nav-active');
            });
            $(document).on('click', '.close-menu', function(evt) {
                evt.preventDefault();
                $('.nav-mobile').removeClass('nav-active');
                $('.sub-menu').removeClass('translate');
            });

            $('html').on('click', function() {
                $('.nav-mobile').removeClass('nav-active');
                $('.sub-menu').removeClass('translate');
            });

            $('.pi-navigation .nav').on('click', function(evt) {
                evt.stopPropagation();
            });
        
        }


        if ($('.skill-bar').length) {
          $.each($('.skill-bar'), function()
          {
            var $skillbar = $(this),
                $pie = $skillbar.find('.pie'),
                $pie1 = $skillbar.find('.pie.pie1'),
                $pie2 = $skillbar.find('.pie.pie2'),
                $percent = $skillbar.find('.percent'),
                per = $percent.text().split('%')[1],
                deg = per*3.6,
                duration = $skillbar.data('duration').split('s')[0],
                Timeout = (duration/(per*2/100))*1000,
                size = $skillbar.data('size'),
                size2 = size/2,
                border = $skillbar.data('widthbar'),
                colorbar = $skillbar.data('colorbar'),
                colorpie = $skillbar.data('colorpie'),
                lhper = size - border*2;
            $pie1.wrap('<div class="half"></div>');
            var $half = $skillbar.find('.half');
            $skillbar.css({
              'width': size + 'px',
              'height': size + 'px'
            });
            $percent.css({
              'lineHeight': lhper + 'px',
              'border': border + 'px solid ' + colorbar
            });
            $pie.css({
              'clip': 'rect(0,' + size2 + 'px,' + size + 'px,0)',
              'border': border + 'px solid ' + colorpie
            });
            $half.css({
              'clip': 'rect(0,' + size + 'px,' + size + 'px,' + size2 + 'px)'
            });
            function skillbarrun() {
              $pie1.css({
                '-webkit-transition': '-webkit-transform ' + duration + 's linear',
                '-moz-transition': '-moz-transform ' + duration + 's linear',
                '-ms-transition': '-ms-transform ' + duration + 's linear',
                '-o-transition': '-o-transform ' + duration + 's linear',
                'transition': 'transform ' + duration + 's linear',
                '-webkit-transform': 'rotate(' + deg + 'deg)',
                '-moz-transform': 'rotate(' + deg + 'deg)',
                '-ms-transform': 'rotate(' + deg + 'deg)',
                '-o-transform': 'rotate(' + deg + 'deg)',
                'transform': 'rotate(' + deg + 'deg)'
              });
              if (deg >= 180) {
                setTimeout(function(){
                  $half.css({
                    'clip': 'rect(0,' + size + 'px,' + size + 'px,0)'
                  });
                  $pie2.css({
                    'visibility': 'visible'
                  });
                }, Timeout);
              }
            }
            $(window).on('scroll', function() {
                var windowHeight = $(window).height(),
                    windowScroll = $(window).scrollTop(),
                    offset = $('.skill').offset().top,
                    heightSkill = $('.skill').height();
                if ((windowHeight + windowScroll) > offset && windowScroll < (offset + heightSkill)) {
                    skillbarrun();
                }
            });
          });
        }

        $.each($('.h-btn'), function() {
            var classtype = $(this).attr("class");
            $(this)
                .wrap('<div class="' + classtype +'"></div>')
                .removeClass();
        });


        if ($(".team-slider").length) 
        {
            $(".team-slider").owlCarousel({
                items: 4,
                itemsDesktop : [1199,3],
                itemsDesktopSmall : [992,2],
                itemsTablet: [767,2],
                itemsTabletSmall: [600,1],
                slideSpeed: 200,
                navigation: false,
                pagination: true,
                navigationText: ['<i class="fa fa-angle-left"></i>', '<i class="fa fa-angle-right"></i>']  
            });
        }

        if ($(".client-slider").length) {
            $(".client-slider").owlCarousel({
                items: 4,
                itemsDesktop : [1199,4],
                itemsDesktopSmall : [992,3],
                itemsTablet: [767,2],
                itemsTabletSmall: [600,1],
                slideSpeed: 200,
                navigation: false,
                pagination: true,
                navigationText: ['<i class="fa fa-angle-left"></i>', '<i class="fa fa-angle-right"></i>']  
            });
        }

        /*==============================
            Testimonial slider
        ==============================*/
        if ($(".testimonial-slider").length) {
            $(".testimonial-slider").owlCarousel({
                autoPlay: 5000,
                slideSpeed: 300,
                navigation: true,
                pagination: false,
                singleItem: true,
                transitionStyle: 'goDown',
                navigationText: ['<i class="fa fa-angle-left"></i>', '<i class="fa fa-angle-right"></i>']  
            });
        }

        if ($('.post-slider').length) {
            $('.post-slider').owlCarousel({
                autoPlay: 6000,
                navigation: true,
                slideSpeed: 200,
                singleItem: true,
                pagination: true,
                transitionStyle: 'fade',
                navigationText: ['<i class="fa fa-angle-left"></i>', '<i class="fa fa-angle-right "></i>']
            });
        }

       
       

        if ($('.text-slider').length) {
            var $effect = $('.text-slider').data("effect");
            $('.text-slider').owlCarousel({
                autoPlay: 5000,
                navigation: false,
                slideSpeed: 200,
                singleItem: true,
                pagination: false,
                transitionStyle: $effect,
                navigationText: ['<i class="fa fa-angle-left"></i>', '<i class="fa fa-angle-right "></i>']
            });
        }

        if ( $("#video-element").length > 0 )
        {
          if(isMobile.any()) {
              $('.controls-video').hide();
          } else {
            $('.fullscreen-video').mb_YTPlayer({
                  containment: ".bg-video",
                  loop: true,
                  startAt: 0,
                  autoPlay: true,
                  showYTLogo: false,
                  showControls: false
              });
              var video = $('.fullscreen-video'),
            videoPlay = $('.controls-video .play'),
            videoPause = $('.controls-video .pause'),
            videoVolume = $('.controls-video .volume'),
            headTitle = $('.header-title');
            videoPlay.hide();
            headTitle.hide();
            $('.video-place').hide();
            videoPlay.on('click', function () {
                video.playYTP();
                videoPause.fadeIn(500);
                videoVolume.fadeIn(500);
                headTitle.fadeOut(500);
                $(this).fadeOut(500);
                $('.video-place').fadeOut(500);
            });
            videoPause.on('click', function () { 
                video.pauseYTP();
                videoPlay.fadeIn(500);
                videoVolume.fadeOut(500);
                headTitle.fadeIn(500);
                $(this).fadeOut(500);
                $('.video-place').fadeIn(500);
            });
            videoVolume.on('click', function () {
                video.toggleVolume();
            });
          }
        }


        if ($('.portfolio').length) {
            var $container = $('.portfolio #portfolio-wrap');
            $container.isotope({
                transitionDuration: '0.4s',
                hiddenStyle: {
                    opacity: 0,
                    transform: 'scale(0.001)'
                },
                visibleStyle: {
                    opacity: 1,
                    transform: 'scale(1)'
                    }
            });
            $('.portfolio #filters a').on('click', function() {
                $('.select-filter').removeClass('select-filter');
                $(this)
                    .parent()
                    .parent('li')
                    .addClass('select-filter');
                var selector = $(this).attr('data-filter');
                $('#portfolio-wrap').isotope({ filter: selector });
                return false;
            });
            $(window).on('load', function() {
                $('#all').trigger('click');
            });
        }

        /*Magnific*/
        var $this = "", $gallery = {}, $items = new Array(), $link = "";
        $(".pi_gallery_popup .pi-magnifig a").each(function()
        {
            $this = $(this);
            $gallery = $this.data("popup");
            if ( $gallery != '' )
            {   
                $gallery = $gallery.split(",");
                
                $.each($gallery, function(n, val)
                {
                    $items[n] = {src: val};
                })

                $this.magnificPopup
                ({
                    type: 'image', // this is default type
                    items: $items,
                    removalDelay: 300,
                    mainClass: 'mfp-fade',
                    gallery:{
                      enabled:true,
                      preload: [0,2], // read about this option in next Lazy-loading section
                      navigateByImgClick: true,
                    }
                });
            }
        })
        
        $(".pi_video_popup .pi-magnifig a").each(function()
        {
            $(this).magnificPopup
            ({
                type: 'iframe', // this is default type
                removalDelay: 300,
                mainClass: 'mfp-fade',
            });
        });

        if ( $(".pi_project_ajax .pi-magnifig a").length>0 )
        { 
            $(".pi_project_ajax .pi-magnifig a").each(function()
            {
                $(this).magnificPopup(
                {
                  type: 'ajax',
                  mainClass: 'portfolio-ajax',
                  callbacks:
                  {
                    elementParse: function(item) 
                    {
                        // item.src = item.el.attr("href");
                    },
                    ajaxContentAdded: function()
                    {
                      if ($('.pp-slider').length) {
                          $('.pp-slider').owlCarousel({
                              autoPlay: 10000,
                              navigation: false,
                              slideSpeed: 300,
                              singleItem: true,
                              pagination: true
                          });
                      }
                    } 
                  }
                })
            })
        }

        if ( isMobile.any() )
        {
            $(".portfolio_item_image").click(function()
            {
                $(this).find(".caption .pi-magnifig a").trigger("click");
                return false;
            })
        }

        /*If the section, which next to portfolio using background, will remove margin of the portffolio*/
        if ( $("#portfolio").next().children(".bg-parallax").length>0 )
        {
            $("#portfolio").css({'padding-bottom': 0});
        }

        /*=========================================*/
        /*  Media 
        /*=========================================*/
          if ( $(".audio-play").length>0 )
          {   
                var $sdata = {};
               $(".audio-play").each(function()
               {  
                  $sdata = $(this).data();
                  SC.oEmbed($sdata.url, { color: "ff0066",auto_play: false, maxheight:$sdata.maxheight},  document.getElementById( $(this).attr("id"))  );
             })
          }


        var background = $('.home-slider').data('background');
        $('.home-slider .item img')
            .css('opacity', '0')
            .before(function () {
                var srcImg = $(this).attr('src');
                return '<div class="' + background +  '" style="background-image: url(' + srcImg + ')">';
            });
        $('.home-slider')
            .find('.item')
            .append('<div class="bg-overlay"></div>');
        

        $(window).on('load', function() {
            $('.preloader').addClass('load');
            parallaxInit();

            if ($('.blog-grid').length) {
                $('.blog-grid').isotope({
                    columnWidth: 0,
                    itemSelector: '.grid-item'
                });
            }
        });

        $(window).on('load resize', function() {
            var windowWidth = window.innerWidth;
            if (windowWidth > 767) {
                $('.service-item .item-content').equalize();
            } else {
                $('.service-item .item-content').height('auto');
            }
        });

        if (isMobile.any()) {
            $('.client-slider')
                .css('height', 'auto')
                .find('.owl-pagination')
                    .css('position', 'static');
            $('.client-item')
                .css({
                    'height': 'auto',
                    'border': '1px solid #efefef'
                });
            $('.client-item')
                .find('.item-content')
                    .css('opacity', '1');
        }


        $('.scroll-top').on('click', function () {
            $('html, body').animate({
                scrollTop: 0
            }, 800, 'easeInOutExpo');
        });

        $(".form-submit #submit").wrap('<div class="h-btn"></div>');
    }

    function pi_background()
    {
        var $dataBg = "", $parseDataBg = "";
        $("section").each(function()
        {
            $dataBg = $(this).attr("data-background");

            if ( typeof $dataBg !='undefined' && $dataBg !='' )
            {
                $parseDataBg = $.parseJSON($dataBg);
                if ( $parseDataBg.bg_type == 'color' && $parseDataBg.color != '' )
                {   
                    $(this).css({'background-color': $parseDataBg.color});
                }else if( $parseDataBg.bg_type == 'image' )
                {
                    $(this).prepend('<div class="bg-parallax" style="background-image:url('+$parseDataBg.src+')"></div>');

                    if ( $parseDataBg.overlay == 1 )
                    {
                        $(this).children(".bg-parallax").after('<div class="bg-overlay"></div>');
                    }
                }
            }
        })
    }

    function parallaxInit() {
        if (isMobile.any()) {
        } else {
            $('.home-media .bg-parallax').parallax("50%", 0.2);
        }
        if (window.innerWidth >= 1280) {
            $('.skill .bg-parallax').parallax("50%", 0.2);
            $('.service .bg-parallax').parallax("50%", 0.2);
            $('.testimonial .bg-parallax').parallax("50%", 0.2);
        }
    }

    function hasThang($target)
    {
        if ( $target == '' || $target.search("#") == -1 )
        {
            return false;
        }else{
            return true;
        }
    }

    //Equalize
    $.fn.equalize = function() {
        var maxHeight = 0;
        this.each(function(){
            if( $(this).height() > maxHeight ) {
                maxHeight = $(this).height();
            }
        });
        this.height(maxHeight);
    };

    // LOAD JS
    $(document).ready(function() {
        main();
        pi_background();
    });
})(jQuery);