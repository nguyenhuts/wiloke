<?php

class piPage extends piCore
{
 
	public function __construct()
	{
		add_action('save_post', array($this, 'pi_save_data'));
		add_action('add_meta_boxes', array($this, 'pi_create_settings'));
	}


	public function pi_save_data($postID)
	{
		if (!current_user_can('edit_post', $postID) ) return;

        if ( defined( 'DOING_AUTOSAVE' ) && DOING_AUTOSAVE ) return;

        if ( !isset($_POST['post_type']) || empty($_POST['post_type']) ) return;
        
        
        if  ( $_POST['post_type'] == 'page' ) :
	    	$data = isset($_POST['post_settings']) ? $_POST['post_settings'] : array();
	    	$data = $this->pi_unslashed_before_update($data);
	    	update_post_meta($postID, "_post_settings", $data);
	    endif;
	} 


	public function pi_create_settings()
	{
		add_meta_box(
			'pi-custom-post-settings',
			__('Page Settings', piCore::LANG),
			array($this, 'pi_setting_builder'),
			'page',
			'normal',
			'default'
		);
	}

}